// build time:Sun Mar 08 2020 16:57:03 GMT+0800 (中国标准时间)
var Vector3={};var Matrix44={};Vector3.create=function(e,r,t){return{x:e,y:r,z:t}};Vector3.dot=function(e,r){return e.x*r.x+e.y*r.y+e.z*r.z};Vector3.cross=function(e,r,t){e.x=r.y*t.z-r.z*t.y;e.y=r.z*t.x-r.x*t.z;e.z=r.x*t.y-r.y*t.x};Vector3.normalize=function(e){var r=e.x*e.x+e.y*e.y+e.z*e.z;if(r>1e-5){r=1/Math.sqrt(r);e.x*=r;e.y*=r;e.z*=r}};Vector3.arrayForm=function(e){if(e.array){e.array[0]=e.x;e.array[1]=e.y;e.array[2]=e.z}else{e.array=new Float32Array([e.x,e.y,e.z])}return e.array};Matrix44.createIdentity=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Matrix44.loadProjection=function(e,r,t,o,a){var n=o*Math.tan(t*Math.PI/180*.5)*2;var i=n*r;e[0]=2*o/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*o/n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=-(a+o)/(a-o);e[11]=-1;e[12]=0;e[13]=0;e[14]=-2*a*o/(a-o);e[15]=0};Matrix44.loadLookAt=function(e,r,t,o){var a=Vector3.create(r.x-t.x,r.y-t.y,r.z-t.z);Vector3.normalize(a);var n=Vector3.create(1,0,0);Vector3.cross(n,o,a);Vector3.normalize(n);var i=Vector3.create(1,0,0);Vector3.cross(i,a,n);Vector3.normalize(i);e[0]=n.x;e[1]=i.x;e[2]=a.x;e[3]=0;e[4]=n.y;e[5]=i.y;e[6]=a.y;e[7]=0;e[8]=n.z;e[9]=i.z;e[10]=a.z;e[11]=0;e[12]=-(r.x*e[0]+r.y*e[4]+r.z*e[8]);e[13]=-(r.x*e[1]+r.y*e[5]+r.z*e[9]);e[14]=-(r.x*e[2]+r.y*e[6]+r.z*e[10]);e[15]=1};var timeInfo={start:0,prev:0,delta:0,elapsed:0};var gl;var renderSpec={width:0,height:0,aspect:1,array:new Float32Array(3),halfWidth:0,halfHeight:0,halfArray:new Float32Array(3)};renderSpec.setSize=function(e,r){renderSpec.width=e;renderSpec.height=r;renderSpec.aspect=renderSpec.width/renderSpec.height;renderSpec.array[0]=renderSpec.width;renderSpec.array[1]=renderSpec.height;renderSpec.array[2]=renderSpec.aspect;renderSpec.halfWidth=Math.floor(e/2);renderSpec.halfHeight=Math.floor(r/2);renderSpec.halfArray[0]=renderSpec.halfWidth;renderSpec.halfArray[1]=renderSpec.halfHeight;renderSpec.halfArray[2]=renderSpec.halfWidth/renderSpec.halfHeight};function deleteRenderTarget(e){gl.deleteFramebuffer(e.frameBuffer);gl.deleteRenderbuffer(e.renderBuffer);gl.deleteTexture(e.texture)}function createRenderTarget(e,r){var t={width:e,height:r,sizeArray:new Float32Array([e,r,e/r]),dtxArray:new Float32Array([1/e,1/r])};t.frameBuffer=gl.createFramebuffer();t.renderBuffer=gl.createRenderbuffer();t.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,t.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,r,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.bindFramebuffer(gl.FRAMEBUFFER,t.frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,t.texture,0);gl.bindRenderbuffer(gl.RENDERBUFFER,t.renderBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,e,r);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,t.renderBuffer);gl.bindTexture(gl.TEXTURE_2D,null);gl.bindRenderbuffer(gl.RENDERBUFFER,null);gl.bindFramebuffer(gl.FRAMEBUFFER,null);return t}function compileShader(e,r){var t=gl.createShader(e);gl.shaderSource(t,r);gl.compileShader(t);if(!gl.getShaderParameter(t,gl.COMPILE_STATUS)){var o=gl.getShaderInfoLog(t);gl.deleteShader(t);console.error(o);return null}return t}function createShader(e,r,t,o){var a=compileShader(gl.VERTEX_SHADER,e);var n=compileShader(gl.FRAGMENT_SHADER,r);if(a==null||n==null){return null}var i=gl.createProgram();gl.attachShader(i,a);gl.attachShader(i,n);gl.deleteShader(a);gl.deleteShader(n);gl.linkProgram(i);if(!gl.getProgramParameter(i,gl.LINK_STATUS)){var l=gl.getProgramInfoLog(i);console.error(l);return null}if(t){i.uniforms={};for(var f=0;f<t.length;f++){i.uniforms[t[f]]=gl.getuniformlocation(i,t[f])}}if(o){i.attributes={};for(var f="0;f<o.length;f++){var" c="o[f];i.attributes[c]=gl.getAttribLocation(i,c)}}return" i}function useshader(e){gl.useprogram(e);for(var r in e.attributes){gl.enablevertexattribarray(e.attributes[r])}}function unuseshader(e){for(var e.attributes){gl.disablevertexattribarray(e.attributes[r])}gl.useprogram(null)}var projection="{angle:60,nearfar:new" float32array([.1,100]),matrix:matrix44.createidentity()};var camera="{position:Vector3.create(0,0,100),lookat:Vector3.create(0,0,0),up:Vector3.create(0,1,0),dof:Vector3.create(10,4,8),matrix:Matrix44.createIdentity()};var" pointflower="{};var" meshflower="{};var" scenestandby="false;var" blossomparticle="function(){this.velocity=new" array(3);this.rotation="new" array(3);this.position="new" array(3);this.euler="new" array(3);this.size="1;this.alpha=1;this.zkey=0};BlossomParticle.prototype.setVelocity=function(e,r,t){this.velocity[0]=e;this.velocity[1]=r;this.velocity[2]=t};BlossomParticle.prototype.setRotation=function(e,r,t){this.rotation[0]=e;this.rotation[1]=r;this.rotation[2]=t};BlossomParticle.prototype.setPosition=function(e,r,t){this.position[0]=e;this.position[1]=r;this.position[2]=t};BlossomParticle.prototype.setEulerAngles=function(e,r,t){this.euler[0]=e;this.euler[1]=r;this.euler[2]=t};BlossomParticle.prototype.setSize=function(e){this.size=e};BlossomParticle.prototype.update=function(e,r){this.position[0]+=this.velocity[0]*e;this.position[1]+=this.velocity[1]*e;this.position[2]+=this.velocity[2]*e;this.euler[0]+=this.rotation[0]*e;this.euler[1]+=this.rotation[1]*e;this.euler[2]+=this.rotation[2]*e};function" createpointflowers(){var e="gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);renderSpec.pointSize={min:e[0],max:e[1]};var" t="document.getElementById("sakura_point_fsh").textContent;pointFlower.program=createShader(r,t,["uProjection","uModelview","uResolution","uOffset","uDOF","uFade"],["aPosition","aEuler","aMisc"]);useShader(pointFlower.program);pointFlower.offset=new" float32array([0,0,0]);pointflower.fader="Vector3.create(0,10,0);pointFlower.numFlowers=1600;pointFlower.particles=new" array(pointflower.numflowers);pointflower.dataarray="new" float32array(pointflower.numflowers*(3+3+2));pointflower.positionarrayoffset="0;pointFlower.eulerArrayOffset=pointFlower.numFlowers*3;pointFlower.miscArrayOffset=pointFlower.numFlowers*6;pointFlower.buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,pointFlower.buffer);gl.bufferData(gl.ARRAY_BUFFER,pointFlower.dataArray,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,null);unuseShader(pointFlower.program);for(var" o="0;o<pointFlower.numFlowers;o++){pointFlower.particles[o]=new" blossomparticle}}function initpointflowers(){pointflower.area="Vector3.create(20,20,20);pointFlower.area.x=pointFlower.area.y*renderSpec.aspect;pointFlower.fader.x=10;pointFlower.fader.y=pointFlower.area.z;pointFlower.fader.z=.1;var" math.random()*2-1};for(var a="0;a<pointFlower.numFlowers;a++){var" n="pointFlower.particles[a];r.x=o()*.3+.8;r.y=o()*.2-1;r.z=o()*.3+.5;Vector3.normalize(r);t=2+Math.random()*1;n.setVelocity(r.x*t,r.y*t,r.z*t);n.setRotation(o()*e*.5,o()*e*.5,o()*e*.5);n.setPosition(o()*pointFlower.area.x,o()*pointFlower.area.y,o()*pointFlower.area.z);n.setEulerAngles(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2);n.setSize(.9+Math.random()*.1)}}function" renderpointflowers(){var>t){if(e.position[r]>0){e.position[r]-=t*2}else{e.position[r]+=t*2}}};var o=function(r,t){r.euler[t]=r.euler[t]%e;if(r.euler[t]</t.length;f++){i.uniforms[t[f]]=gl.getuniformlocation(i,t[f])}}if(o){i.attributes={};for(var>